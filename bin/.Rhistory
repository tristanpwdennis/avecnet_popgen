#setup env
#load and.or install packages we need
pkg = c("tidyverse", "sjPlot", "cowplot", "data.table", "DHARMa", "lme4", "MASS", "ggthemes")
#install.packages(pkg) #install packages if you need them and load
new.packages <- pkg[!(pkg %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(pkg, require, character.only = TRUE)#
#set cowplot theme
theme_set(theme_cowplot(font_size=17, font_family = "serif") +
theme(text = element_text(colour = "black")))
#-----------------------------------------------------------#
#load and wrangle data
#-----------------------------------------------------------#
#metadata
metadata <- fread('~/Projects/avecnet_popgen/sequenced_metadata_avecnet.csv')
#-----------------------------------------------------------#
#load and wrangle data
#-----------------------------------------------------------#
#metadata
metadata <- fread('~/Projects/avecnet_popgen/metadata/sequenced_metadata_avecnet.csv')
#treatment history
txhist = fread('~/Projects/avecnet_popgen/metadata/txhistory.csv')
#load fsts
fst_df =  fread("~/Projects/avecnet_popgen/avecnet_fst.csv")
#pca
x =  fread('/Users/dennistpw/Library/Mobile Documents/com~apple~CloudDocs/Projects/anopheles_cnrfp/pcangsd_output/allsamples/pcangsd.cov')
View(metadata)
#pca
x =  fread('~/Projects/avecnet_popgen/data/pca/pcangsd.cov')
pca = eigen(x)
pcaframe = cbind(data.frame(pca$vectors), metadata_seq_fis)
#add pc variance explained
varex = pca$values/sum(pca$values)
barplot(varex[1:20])
pc12plot = ggplot(pcaframe, aes(x=X1, y=X2, colour=as.factor(treated)))+
scale_color_manual(values = pal)+
labs(x="PC1 (0.7%)", y="PC2 (0.1%)", colour = 'Treated')+
geom_point(alpha=0.7)+
theme_tufte()+
theme(text = element_text(size = 17))
pcaframe = cbind(data.frame(pca$vectors), metadata_seq_fis)
#setup env
#load and.or install packages we need
pkg = c("tidyverse", "sjPlot", "cowplot", "data.table", "DHARMa", "lme4", "MASS", "ggthemes")
#install.packages(pkg) #install packages if you need them and load
new.packages <- pkg[!(pkg %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(pkg, require, character.only = TRUE)#
#set cowplot theme
theme_set(theme_cowplot(font_size=17, font_family = "serif") +
theme(text = element_text(colour = "black")))
#-----------------------------------------------------------#
#load and wrangle data
#-----------------------------------------------------------#
#metadata
metadata <- fread('~/Projects/avecnet_popgen/metadata/sequenced_metadata_avecnet.csv')
#treatment history
txhist = fread('~/Projects/avecnet_popgen/metadata/txhistory.csv')
#load fsts
fst_df =  fread("~/Projects/avecnet_popgen/avecnet_fst.csv")
#between each group and every other group
fst =fst_df %>% group_by(month_a, cluster_a, year_a, treated) %>% summarise(mean_fst = mean(fst_weighted))
#make timepoints and cap negative fst at zero
fst$fst = pmax(fst$mean_fst,0)
#-----------------------------------------------------------#
#load and wrangle data
#-----------------------------------------------------------#
#metadata
metadata <- fread('~/Projects/avecnet_popgen/metadata/sequenced_metadata_avecnet.csv')
#treatment history
txhist = fread('~/Projects/avecnet_popgen/metadata/txhistory.csv')
#load fsts
fst_df =  fread("~/Projects/avecnet_popgen/avecnet_fst.csv")
#load fsts
fst_df =  fread("~/Projects/avecnet_popgen/data/fst/avecnet_fst.csv")
#load fsts
fst_df =  fread("~/Projects/avecnet_popgen/data/fst/fst_xyearmo_xcluster.txt")
#between each group and every other group
fst =fst_df %>% group_by(month_a, cluster_a, year_a, treated) %>% summarise(mean_fst = mean(fst_weighted))
#make timepoints and cap negative fst at zero
fst$fst = pmax(fst$mean_fst,0)
fst$timep = paste0(fst$year_a,'_',fst$month_a)
fst$timep <- factor(fst$timep, levels = c("2014_7","2014_8","2014_9","2014_11","2015_7","2015_9","2015_11"))
#read thetas
thetas=fread('~/Projects/anopheles_pmi_cnrfp/data/thetas/avecnet_thetas.csv')
#read thetas
thetas=fread('~/Projects/anopheles_pmi_cnrfp/data/thetas/avecnet_thetas.csv')
#read thetas
thetas=fread('~/Projects/avecnet_popgen/data/thetas/avecnet_thetas.csv')
#inbreeding coefficients
inbreedin_coeffs = fread('~/Projects/avecnet_popgen/data/fis/cnrfp_3l.34856_seed.final', col.names = c('fis_pcangsd'))
#inbreeding coefficients
inbreedin_coeffs = fread('~/Projects/avecnet_popgen/data/fis/cnrfp_3l.34856_seed.final', col.names = c('fis_pcangsd'))
metadata_tx = left_join(metadata, txhist, by = c('month'='mo', 'year','Cluster'='cluster'))
metadata_tx = left_join(metadata, txhist, by = c('month'='mo', 'year','custer'='cluster'))
metadata_tx = left_join(metadata, txhist, by = c('month'='mo', 'year','cluster')
metadata_tx = left_join(metadata, txhist, by = c('month'='mo', 'year','cluster'))
metadata_tx = left_join(metadata, txhist, by = c('month'='mo', 'year','cluster'))
metadata_seq_fis = cbind(metadata_tx, inbreedin_coeffs)
hist(fst$fst)
#dual colour palette yellow and blue
pal = c('#f2be54','#153e5c')
#pca
x =  fread('~/Projects/avecnet_popgen/data/pca/pcangsd.cov')
pca = eigen(x)
pcaframe = cbind(data.frame(pca$vectors), metadata_seq_fis)
#add pc variance explained
varex = pca$values/sum(pca$values)
barplot(varex[1:20])
pc12plot = ggplot(pcaframe, aes(x=X1, y=X2, colour=as.factor(treated)))+
scale_color_manual(values = pal)+
labs(x="PC1 (0.7%)", y="PC2 (0.1%)", colour = 'Treated')+
geom_point(alpha=0.7)+
theme_tufte()+
theme(text = element_text(size = 17))
pc12plot
pcaframe
#-----------------------------------------------------------#
#avecnet genomics analysis
#-----------------------------------------------------------#
#setup env
#load and.or install packages we need
pkg = c("tidyverse", "sjPlot", "cowplot", "data.table", "DHARMa", "lme4", "MASS", "ggthemes")
#install.packages(pkg) #install packages if you need them and load
new.packages <- pkg[!(pkg %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(pkg, require, character.only = TRUE)#
#set cowplot theme
theme_set(theme_cowplot(font_size=17, font_family = "serif") +
theme(text = element_text(colour = "black")))
#-----------------------------------------------------------#
#load and wrangle data
#-----------------------------------------------------------#
#metadata
metadata <- fread('~/Projects/avecnet_popgen/metadata/sequenced_metadata_avecnet.csv')
#load fsts
fst_df =  fread("~/Projects/avecnet_popgen/data/fst/fst_xyearmo_xcluster.txt")
#between each group and every other group
fst =fst_df %>% group_by(month_a, cluster_a, year_a, treated) %>% summarise(mean_fst = mean(fst_weighted))
#make timepoints and cap negative fst at zero
fst$fst = pmax(fst$mean_fst,0)
fst$timep = paste0(fst$year_a,'_',fst$month_a)
fst$timep <- factor(fst$timep, levels = c("2014_7","2014_8","2014_9","2014_11","2015_7","2015_9","2015_11"))
#read thetas
thetas=fread('~/Projects/avecnet_popgen/data/thetas/avecnet_thetas.csv')
#inbreeding coefficients
inbreedin_coeffs = fread('~/Projects/avecnet_popgen/data/fis/cnrfp_3l.34856_seed.final', col.names = c('fis_pcangsd'))
metadata_tx = left_join(metadata, txhist, by = c('month'='mo', 'year','cluster'))
metadata_seq_fis = cbind(metadata_tx, inbreedin_coeffs)
metadata_seq_fis = cbind(metadata, inbreedin_coeffs)
#bind iunbreeding coeffs to data
metadata_seq_fis = cbind(metadata, inbreedin_coeffs)
#-----------------------------------------------------------#
#models of difference in fst, pi and fis by year and tx
#-----------------------------------------------------------#
#model (insignificant)
m1 = glm.nb(formula = mean_fst ~ treated * as.factor(year_a), data = fst)
m1simulationOutput <- simulateResiduals(fittedModel = m1, plot = F)
residuals(m1simulationOutput, quantileFunction = qnorm, outlierValues = c(0,1))
plot(m1simulationOutput)
drop1(m1)
#model for pi
m2 = glm.nb(formula = pi ~ treated * as.factor(year), data = thetas)
summary(m2)
m2simulationOutput <- simulateResiduals(fittedModel = m2, plot = F)
residuals(m2simulationOutput, quantileFunction = qnorm, outlierValues = c(0,1))
plot(m2simulationOutput)
drop1(m2)
#fis
m3 = glm.nb(formula = fis_ngsf ~ treated * as.factor(year), data = metadata_seq_fis)
summary(m3)
m3simulationOutput <- simulateResiduals(fittedModel = m3, plot = F)
residuals(m3simulationOutput, quantileFunction = qnorm, outlierValues = c(0,1))
plot(m3simulationOutput)
drop1(m3)
#dual colour palette yellow and blue
pal = c('#f2be54','#153e5c')
#pca
x =  fread('~/Projects/avecnet_popgen/data/pca/pcangsd.cov')
pca = eigen(x)
pcaframe = cbind(data.frame(pca$vectors), metadata_seq_fis)
#add pc variance explained
varex = pca$values/sum(pca$values)
barplot(varex[1:20])
pc12plot = ggplot(pcaframe, aes(x=X1, y=X2, colour=as.factor(treated)))+
scale_color_manual(values = pal)+
labs(x="PC1 (0.7%)", y="PC2 (0.1%)", colour = 'Treated')+
geom_point(alpha=0.7)+
theme_tufte()+
theme(text = element_text(size = 17))
pc12plot
#fsts
fstplt = ggplot(fst, aes(x=as.factor(year_a), y=mean_fst, colour=as.factor(treated)))+
geom_jitter(position = position_jitterdodge(),alpha=0.7)+
geom_boxplot(outlier.shape = NA, alpha=0.5)+
labs(x='', y='Fst')+
theme_tufte()+
scale_color_manual(values = pal)+
theme(text = element_text(size = 17)) +
theme(legend.position = "none")
#theta treated vs untreated all
piplt = ggplot(thetas, aes(x=as.factor(year), y=pi,color=as.factor(treated)))+
geom_jitter(position = position_jitterdodge(),alpha=0.7)+
geom_boxplot(outlier.shape = NA, alpha=0.5)+
labs(x='', y='Ï€')+
theme_tufte()+
scale_color_manual(values = pal)+
theme(text = element_text(size = 17)) +
theme(legend.position = "none")
#inbreeding coeffs
fisplt = ggplot(metadata_seq_fis, aes(x=as.factor(year), y=fis_ngsf,color=as.factor(treated)))+
geom_jitter(position = position_jitterdodge(),alpha=0.7)+
geom_boxplot(outlier.shape = NA, alpha=0.5)+
labs(x='', y='Fis')+
theme_tufte()+
scale_color_manual(values = pal)+
theme(text = element_text(size = 17)) +
theme(legend.position = "none")
pcalegend = get_legend(pc12plot) #extract legend
#plot all together
divplots = cowplot::plot_grid(fstplt,
piplt,
fisplt,
pcalegend,
labels=c('B','C','D'))
metadata_seq_fis
#inbreeding coefficients
inbreedin_coeffs = fread('~/Projects/avecnet_popgen/data/fis/cnrfp_3l.34856_seed.final', col.names = c('fis'))
#inbreeding coeffs
fisplt = ggplot(metadata_seq_fis, aes(x=as.factor(year), y=fis,color=as.factor(treated)))+
geom_jitter(position = position_jitterdodge(),alpha=0.7)+
geom_boxplot(outlier.shape = NA, alpha=0.5)+
labs(x='', y='Fis')+
theme_tufte()+
scale_color_manual(values = pal)+
theme(text = element_text(size = 17)) +
theme(legend.position = "none")
pcalegend = get_legend(pc12plot) #extract legend
#plot all together
divplots = cowplot::plot_grid(fstplt,
piplt,
fisplt,
pcalegend,
labels=c('B','C','D'))
metadata_seq_fis
#bind iunbreeding coeffs to data
metadata_seq_fis = cbind(metadata, inbreedin_coeffs)
#inbreeding coeffs
fisplt = ggplot(metadata_seq_fis, aes(x=as.factor(year), y=fis,color=as.factor(treated)))+
geom_jitter(position = position_jitterdodge(),alpha=0.7)+
geom_boxplot(outlier.shape = NA, alpha=0.5)+
labs(x='', y='Fis')+
theme_tufte()+
scale_color_manual(values = pal)+
theme(text = element_text(size = 17)) +
theme(legend.position = "none")
pcalegend = get_legend(pc12plot) #extract legend
#plot all together
divplots = cowplot::plot_grid(fstplt,
piplt,
fisplt,
pcalegend,
labels=c('B','C','D'))
countplots = cowplot::plot_grid(pc12plot + theme(legend.position = "none"),
divplots,
labels = 'A')
countplots
res = fread('~/Projects/avecnet_popgen/data/relatedness/AgamP4_3L.res')
View(res)
left_join(res, metadata_seq_fis, by=c('a'='bamorder'))
left_join(res, metadata_seq_fis, by=c('a'='bamorder')) %>% left_join(., metadata, by=c('b'='bamorder'))
res = left_join(res, metadata_seq_fis, by=c('a'='bamorder')) %>% left_join(., metadata, by=c('b'='bamorder'))
res$pdist = distVincentyEllipsoid(res[,c('lat.x','long.x')], res[,c('lat.y','long.y')])
res$pdist = geosphere::distVincentyEllipsoid(res[,c('lat.x','long.x')], res[,c('lat.y','long.y')])
ggplot(res, aes(x=pdist, y=KING))+
geom_point()
ggplot(res, aes(x=pdist, y=rab))+
geom_point()
res$txpair <- paste0(res$treated.x, res$treated.y)
res %>% group_by(txpair)
ggplot(aes(x=txpair, y=rab))+
geom_boxplot()
ggplot(res,aes(x=txpair, y=rab))+
geom_boxplot()
ggplot(res,aes(x=txpair, y=KING))+
geom_boxplot()
fread('~/Desktop/md5')
x = fread('~/Desktop/md5')
View(x)
x = fread('~/Desktop/md5', header=F)
x
basename(x$V2)
x$V2 = basename(x$V2)
x
write_delim(x, file='~/Desktop/newmd5')
